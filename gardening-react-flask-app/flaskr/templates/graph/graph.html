<!DOCTYPE html>
<meta charset="utf-8">
<style>

  div.tooltip {
      position: absolute;
      text-align: center;
      width: 60px;
      height: 42px;
      padding: 2px;
      font: 12px sans-serif;
      background: lightsteelblue;
      border: 0px;
      border-radius: 8px;
      pointer-events: none;
  }

</style>
<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>



<script>




d3.json("/api/get_graph_data", function(error, data) {
  if (error) throw error;
  // set the dimensions and margins of the graph
  var margin = {top: 10, right: 30, bottom: 30, left: 60},
     width = 1000 - margin.left - margin.right,
     height = 400 - margin.top - margin.bottom;

  // append the svg object to the body of the page
  var svg = d3.select("#my_dataviz")
   .append("svg")
     .attr("width", width + margin.left + margin.right)
     .attr("height", height + margin.top + margin.bottom)
   .append("g")
     .attr("transform",
           "translate(" + margin.left + "," + margin.top + ")");

   // Add X axis
   var x = d3.scaleTime()
     .domain([Date.now() - 1000*60*60*24*3, Date.now()])
     .range([ 0, width ])
     .nice()
   svg.append("g")
     .attr("transform", "translate(0," + height + ")")
     .call(d3.axisBottom(x));

   // Add Y axis
   var y = d3.scaleLinear()
     .domain([0, 1000])
     .range([ height, 0]);
   svg.append("g")
     .call(d3.axisLeft(y));

   // colrscale
   var colorScale = d3.scaleOrdinal(d3.schemeCategory10)


   var formatTime = d3.timeFormat("%e %b");

   // Define the div for the tooltip
   var div = d3.select("body").append("div")
       .attr("class", "tooltip")
       .style("opacity", 0);


   // Add dots
   svg.append('g')
     .selectAll("dot")
     .data(data)
     .enter()
     .append("circle")
       .attr("cx", function (d) { return x(d['timestamp']*1000); } )
       .attr("cy", function (d) { return y(d['value']); } )
       .attr("r", 3)
       .style("fill", function(d, i) { return colorScale(d['device_id']); } )
       .on("mouseover", function(d) {
           div.transition()
               .duration(200)
               .style("opacity", .9);
           div.html(d.name + "<br/>" + formatTime(d.timestamp*1000) + "<br/>" + d.value)
               .style("left", (d3.event.pageX) + "px")
               .style("top", (d3.event.pageY - 28) + "px");
           })
       .on("mouseout", function(d) {
           div.transition()
               .duration(500)
               .style("opacity", 0);
       });
});




</script>